#:kivy 2.3.1
#:import Window kivy.core.window.Window
#:import path os.path
#:import utils libs.applibs.utils

<FileSelectionScreen>:
    name: "file_selection"
    md_bg_color: self.theme_cls.backgroundColor

    MDIconButton:
        icon: "arrow-left"
        x: dp(10)
        top: Window.height - dp(10)
        on_release:
            app.change_root_screen("main")
            root.clear_files_list()

    MDScrollView:
        do_scroll_x: False

        MDBoxLayout:
            orientation: "vertical"
            adaptive_height: True
            spacing: dp(30)
            padding: dp(20)

            MDLabel:
                text: "ZapFS"
                bold: True
                adaptive_height: True
                halign: "center"
                theme_font_size: "Custom"
                font_size: sp(72)

            DropArea:
                id: drop_area
                size_hint_x: 0.8
                adaptive_height: True
                pos_hint: {"center_x": 0.5}
                on_release:
                    root.on_browse_files_btn()

            MDBoxLayout:
                id: mainbox
                orientation: "vertical"
                pos_hint: {"center_x": 0.5}
                size_hint: 0.8, None
                height: max(Window.height * 0.8, 300)
                spacing: dp(20)
                opacity: 1 if len(files_rv.data) else 0

                MDBoxLayout:
                    id: bottom_bar
                    orientation: "vertical"
                    adaptive_height: True
                    pos_hint: {"center_x": 0.5}


                    MDBoxLayout:
                        adaptive_height: True
                        padding: dp(15)

                        MDLabel:
                            adaptive_height: True
                            text: "Selected Files (" + str(len(files_rv.data)) + " files, " + utils.hr_size(root.total_file_size) + ")"
                            font_style: "Headline"
                            role: "large"
                            bold: True

                        MDButton:
                            style: "filled"
                            radius: dp(5)
                            on_release:
                                root.on_send_btn()

                            MDButtonText:
                                text: "Send Files"

                    MDDivider:

                MDRecycleView:
                    id: files_rv
                    viewclass: "FileViewItem"

                    RecycleBoxLayout:
                        default_size_hint: 1, None
                        default_size: None, None

                        size_hint_y: None
                        height: self.minimum_height
                        orientation: "vertical"

                        padding: dp(10)
                        spacing: dp(10)


<FileViewItem>:
    radius: 10
    spacing: dp(10)
    padding: dp(15), dp(10)
    adaptive_height: True
    size_hint_x: 1
    md_bg_color: self.theme_cls.surfaceContainerLowColor

    MDBoxLayout:
        md_bg_color: self.theme_cls.surfaceContainerHighestColor
        adaptive_size: True
        pos_hint: {"center_y": 0.5}
        padding: dp(10)
        radius: root.radius[0]

        MDIcon:
            icon: "file"
            pos_hint: {"center_y": 0.5}
            theme_font_size: "Custom"
            font_size: sp(45)
            text_color: self.theme_cls.onSurfaceColor

    MDBoxLayout:
        orientation: "vertical"
        adaptive_height: True

        MDLabel:
            text: path.basename(root.filepath)

            adaptive_height: True
            pos_hint: {"center_y": 0.5, "center_x": 0.5}

            font_style: "Title"
            role: "large"

            shorten: True
            shorten_from: "left"

        MDLabel:
            text: path.dirname(root.filepath)

            adaptive_height: True
            pos_hint: {"center_y": 0.5, "center_x": 0.5}

            font_style: "Body"
            role: "large"

            theme_text_color: "Custom"
            text_color: self.theme_cls.disabledTextColor

            shorten: True
            shorten_from: "left"

        MDLabel:
            text: utils.hr_size(root.filesize)

            adaptive_height: True
            pos_hint: {"center_y": 0.5, "center_x": 0.5}

            font_style: "Body"
            role: "large"

            theme_text_color: "Custom"
            text_color: self.theme_cls.disabledTextColor

    MDIconButton:
        pos_hint: {"center_y": 0.5}
        icon: "close"
        style: "standard"
        theme_icon_color: "Custom"
        icon_color: self.theme_cls.onSurfaceColor
        on_release:
            root.callback({"filepath": root.filepath, "filesize": root.filesize, "callback": root.callback})

<DropArea>:
    orientation: "vertical"
    adaptive_height: True
    spacing: dp(20)
    padding: 0, dp(30), 0, dp(60)

    canvas.after:
        Color:
            rgba: self.theme_cls.primaryColor
        Line:
            width: 1
            dashes: 10, 5
            rounded_rectangle:
                self.x, self.y,\
                self.width, self.height,\
                self.radius[0], self.radius[1],\
                self.radius[2], self.radius[3]

    MDIcon:
        icon: "cloud-upload"
        theme_font_size: "Custom"
        font_size: sp(72)
        halign: "center"
        pos_hint: {"center_x": 0.5}
        text_color: self.theme_cls.primaryColor
        adaptive_size: True
        width: self.texture_size[0]

    MDBoxLayout:
        orientation: "vertical"
        adaptive_height: True
        spacing: dp(5)
        MDLabel:
            halign: "center"
            bold: True
            text: "Drag & Drop Files Here"
            theme_font_size: "Custom"
            font_size: sp(30)
            adaptive_size: True
            width: self.texture_size[0]
            pos_hint: {"center_x": 0.5}

        MDLabel:
            halign: "center"
            text: "or click to browse"
            theme_font_size: "Custom"
            font_size: sp(22)
            adaptive_size: True
            width: self.texture_size[0]
            pos_hint: {"center_x": 0.5}
            text_color: self.theme_cls.disabledTextColor
